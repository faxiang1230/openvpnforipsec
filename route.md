# route issue
## 默认路由为什么netmask是0.0.0.0
我们知道通过地址和子网掩码可以知道主机号，网络号，子网号;
主机号:ip&~netmask=ip&255.255.255.255,网络号是通过协议分配的,A,B,C,D,E类，网络号为:
ip&netmask而0.0.0.0中网络号为0,属于特殊的IP地址，只能做源端地址而不能做目的端地址;
什么地方做了特殊处理使其称为默认路由呢?
# NAT做了什么
我们知道NAT(Net address transform)主要是为了节省ipv4的空间，多台主机可以共用一个公共
ip,发包的时候修改了源地址和mac地址,端口号，保持目的地址不变，除了源地址之外还需要修改CRC校验值;
并且port和主机对应，每个主机就相当于一个应用,根据port可以找到主机路由回去
包回来的时候，根据端口号能够路由到目的主机，这时候应该修改目的地址,mac地址,端口号;
这三种信息在哪里保存呢?
## 路由的顺序
我们晓得路由表的查找顺序:
1.网络+主机名相匹配的
2.网络匹配
3.默认路由表(默认表项一般在路由表中被指定为一个网络表项，网络号为0)

## 各协议层的主要职责
传输层
保证数据能够到达目的端，另外还可能保证可靠性，完整性等
网络层
快速路由和不同子网间传输
链路层
保证物理层发送的信号正确，物理层会受周围环境的影响可能发生传输错误等，链路层保证和纠错物理层的信号，向上层保证下面数据传输一定完成
物理层
通过物理设备发送信号，接收信号，解析信号，位于物理层上的设备有网线，接收端，发送端，中继器等，只有物理层是真实存在的，其他的东西都是逻辑层的玩意
## VPN
虚拟专用网有两个职责:虚拟和专用  
专用:保密不被窃听，能够实现身份认证  
虚拟:数据被发出之后它不知道真实的路由情况，只以为还在发出的那个局域网内，虚拟就是使数据产生错觉，起始端和目的端在同一个网段中.在公用网络中实现私有网络
典型的实现方式是隧道，将真实的数据包裹加密,本质的需求是能够相互独占访问并且进行数据保密，也不必非要实现隧道。
数据保密在于如何能够截获到所有需要保护的数据流,根据数据的流向：应用层->系统库->协议栈->网卡；
在应用层进行保护的话应该只能保护特定的应用，即特定的资源访问，毕竟你不可能改造所有的应用端;
在系统库层和在应用层遇到相同的问题，有动态链接和静态链接的可执行程序，而静态链接的程序根本管你的系统库有没有加密，一人吃饱全家不饿，没有办法控制这种类型
在协议栈有传输层和网络层，链路层，物理层,从功能上看链路层和物理层都不适合，他们主要负责物理通信的可靠性;
而传输层加密呢?
IP层的加密有典型的IPSec,能够加密所有的IP数据包;
网卡这一层主要就是虚拟网卡的应用了，有tun/tap设备虚拟网卡;同样的虚拟设备还有bridge和veth，为什么不选用他们的?
除了隧道还有什么VPN呢?代理算吗?
## tunnel
在现实中有隧道存在，地铁隧道，火车隧道，海底隧道等;有一个特征:不用管隧道外面是什么(山，河,地上，地下等)，我只知道隧道的下一站是什么.
和它相对应的一个概念应该是承载:在分层模型中，我只管我本层的东西，其他层的我不管.这里承载就像与隧道的实现方式;
承载有三种:
下层承载上层数据，这就是典型的TCP/IP模型；
还有同层承载,经典的IPSec实现方式，在IP层之前加了一个IPSec的头和尾,里面的数据(原始的IP头和TCP/UDP报文)被当成TCP/UDP数据了.
还有上层承载下层数据的方式:例如TCP中的净载荷已经是一个以太网帧，例如openvpn
## IP层特性
路由，分片，组合
## 网关
网关又称为网间连接器、协议转换器，在网络层以上实现网络互连,仅用于两个高层协议不同的网络互连.实质上是一个网络通向其他网络的IP地址，就是我们通过route看到的gw,
是具有路由功能的设备的IP地址.
而路由的作用就是连接不同的网络
以太网和令牌网互联需要使用网桥，是在链路层上进行互联;路由是在网络层上进行互联;
